name: Issue Assignment Follow-up Reminder

on:
  schedule:
    - cron: "0 9 * * *" # Runs daily at 9:00 AM UTC
  workflow_dispatch:      # Allows manual triggering for testing

permissions:
  issues: write           # Required to post comments

jobs:
  remind:
    runs-on: ubuntu-latest
    steps:
      - name: Check assigned issues with no recent activity
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const TWO_DAYS_MS = 2 * 24 * 60 * 60 * 1000;
            const now = new Date().getTime();
            
            // Fetch all open issues (using paginate to get more than 100 if necessary)
            const issues = await github.paginate(github.rest.issues.listForRepo, {
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: "open",
            });

            for (const issue of issues) {
              // 1. Skip Pull Requests (they share the same API)
              if (issue.pull_request) continue;

              // 2. Skip issues that have no assignees
              if (issue.assignees.length === 0) continue;

              // 3. Check time difference
              const updatedAt = new Date(issue.updated_at).getTime();
              const diff = now - updatedAt;

              if (diff > TWO_DAYS_MS) {
                const assignees = issue.assignees
                  .map(a => `@${a.login}`)
                  .join(" ");

                console.log(`Reminding ${assignees} on issue #${issue.number}`);

                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  body: `
            ðŸ‘‹ Hi ${assignees},

            Just a gentle reminder regarding this issue ðŸ˜Š  
            It has been **2+ days** since the last update.

            Could you please share a quick status update?
            - Are you still working on this?
            - Do you need any help or clarification?

            If you're unable to continue, feel free to unassign so someone else can take it up.

            Thanks for your contribution ðŸš€
                  `
                });
              }
            }
